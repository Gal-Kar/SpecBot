import requests
from huepy import *
from urllib.parse import unquote
from tqdm import tqdm

from urllib.parse import urljoin, urlparse, parse_qs, urlencode

def process_link(url, payload):
	query = urlparse(url).query
	if query != '':
		return url.replace(query, urlencode({x: payload for x in parse_qs(query)}))

class sqli:
	@classmethod
	def main(self, url, path_to_payloads):
		self.url = url
		self.payloads = open(path_to_payloads, 'r').read().splitlines()

		found = False
		for payload in self.payloads:
			final_url = process_link(url, payload)

			try:
				req = requests.get("{}".format(final_url))
				res = req.text
				if 'SQL' in res or 'sql' in res or 'Sql' in res:
					print("[" + green("SQLI") + "] " + final_url)
					found = True
					break
			except:
				pass

		result = {
			'url': url.split('?')[0],
			'message': 'SQL Injection found at ' + url,
			'type': 'SQL Injection',
			'priority': 'High',
			'suggestions': ['https://www.w3schools.com/sql/sql_injection.asp']
		} if found else None
		return [result]
